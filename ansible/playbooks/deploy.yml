---
- name: Deploy healthcheck to target servers
  hosts: all
  become: true
  gather_facts: true

  tasks:
    - name: Ensure app directory exists
      file:
        path: /opt/healthcheck
        state: directory
        owner: rocky
        group: rocky
        mode: '0755'

    - name: Sync repository content
      synchronize:
        src: "{{ playbook_dir }}/../../"
        dest: /opt/healthcheck
        delete: yes
        rsync_opts:
          - "--exclude=.git"
          - "--exclude=ansible/secrets"
          - "--exclude=ansible/files/*.vault"
